<%#= javascript_include_tag 'customSelect' %>
<div>
<div id="sidebar">
<h3><%#= @orderstart.to_time.strftime('%d %b %y') %> to <%#= @orderend.to_time.strftime('%d %b %y') %><span class="note"><br /><%#= @orderdiff %> days </span></h3>

  <h3><%#=  number_to_currency( @vend["totalsales"], :unit => "£") %></h3>
  <h3><%#= (@orderactive.to_f / @orderdiff.to_f).round(1) %> orders per day</h3>
  <h3><%#= @orders.size %> total orders</h3>
  <h3><%#= @orderactive %> ok orders</h3>
  <h3><%#= @vend["ordercancelled"] %> cancelled orders     <span class="note">(<%#= number_to_percentage(@order_cancel_perc) %>)</span> </h3>
  <h3><%#= @vend["ordercount"] %> items sold <span class="note"><%#= (@vend["ordercount"].to_f / @orderactive.to_f).round(2) %> items per order </span></h3>

  <ul>
    <li><%= link_to 'Store Admin', 'http://www.shopify.com/developers/api/' %>
      <span class="note">Click here to back to your store admin area</span>
    </li>
    <li><%= link_to 'Pull Orders', :action => "initial_pull" %>
    <span class="note">Click here to get all your previous Orders</span>
    </li>
  </ul>
</div>
<% if !@o_years.blank? %>
<% if @order_year %>
   <select id="war_reg">
                    <% @order_year.each do |w| %>
	          	        <option value="<%= w %>"><%= w %></option>
    	         <% end %>
    	           
	       </select>
  <% end %>  <% end %>
<div id="orders">	
<!--<h4>Sales By Brand <span class="datenote">
Date range:<%= form_tag({:action => "index"},{:class => "orderform"}) do  %>
	<%= datepicker_input "","startdate", :dateFormat => "yy-mm-dd",:size => 12, :showButtonPanel => "true" %>
	<%= datepicker_input "","enddate", :dateFormat => "yy-mm-dd",:size => 12, :showButtonPanel => "true" %>
	<%= submit_tag("Search") %>
<% end %></span>
</h4>-->
 <div id="result">
  <% if @local_orders.blank? %>  
    <em class="note">There are no orders in your store.</em>
  <% else %>
  
  <!-------------------------------------------------------------------------------------->
 <table border ="2">
  <tr>
    <th>Vendor Name</th>
    
     <% @months.each do |m| %>
     <th><%= m %> </th>
      <% end %>
      </tr>
    
   <% @m = [1,2,3,4,5,6,7,8,9,10,11,12]%> 
   <% @v_size = @local_vendors.size %>
    <% @local_vendors.each do |v| %>
   
  <tr>
  
  <th> <%= v.vendor %></th>
   
    <% @years = {} %>
   <% @local_orders.each do |l| %>
   
   <% if l.vendor_name == v.vendor %>
        
   <% @m.each do |m| %>
     
   
     <% if l.month_list == m.to_s %>
       
     <% @years[v.vendor] ||= {}%>
     <% @years[v.vendor][m] ||= [] %>
     <% @years[v.vendor][m] << number_to_currency(l.totcost, :unit => "£").to_s %>
     
     <% end %>
   
     <% end %>
   
      <% end %>
      <% end %>
   
  
     <% if !@years.blank? %> 
     <% @years.each do |y| %>
        	<% if y[0] == v.vendor %>
  		
	
     				<% if !y[1][1].blank? %><td><%= change_to_value(y[1][1].to_s) %></td>
     				      <%else %><td><%= number_to_currency(0,:unit => "£") %></td>
     				      <% end %>
     				<% if !y[1][2].blank? %><td><%=change_to_value(y[1][2].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     				<% if !y[1][3].blank? %><td><%=change_to_value(y[1][3].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     				<% if !y[1][4].blank? %><td><%=change_to_value(y[1][4].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     				<% if !y[1][5].blank? %><td><%=change_to_value(y[1][5].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     				<% if !y[1][6].blank? %><td><%=change_to_value(y[1][6].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     				<% if !y[1][7].blank? %><td><%=change_to_value(y[1][7].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     				<% if !y[1][8].blank? %><td><%=change_to_value(y[1][8].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     				<% if !y[1][9].blank? %><td><%=change_to_value(y[1][9].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     				<% if !y[1][10].blank? %><td><%=change_to_value(y[1][10].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     				<% if !y[1][11].blank? %><td><%=change_to_value(y[1][11].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     				<% if !y[1][12].blank? %><td><%=change_to_value(y[1][12].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => "£") %></td><% end %>
     		
     	<% end %>
     	<% end %>
    <% else %>
        	<td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td><td><%= number_to_currency(0,:unit => "£") %></td>
    <% end %>

</tr> 
     <% end %>
  </table>
  <% end %>
  </div>
  <!-------------------------------------------------------------------------------------->
<!--<ul>-->
<table>
<%# @vend = @vend.sort {|a,b,c| -1*(a[1]<=>b[1]) }  %>
<% 
	@brandcount = 0
	@vend.each do |key, value,value2| %>
<% #if key != "ordercount" && key != "ordercancelled" && key != "totalsales" &&  key != "Jura Watches" then %>
<tr class="box">     
	<td><%#= @brandcount %></td><td class="brand"><strong> <%= key %></strong></td><td class="price"><%#= number_to_currency(value, :unit => "£") %></td><td class="price"><%#= number_to_currency(value2, :unit => "£") %></td>
</tr>
<!--
<li>
       <div class="order box">
         <div class="wrapper">
           <span class="brand"><strong> <%= key %></strong></span>
           <span class="price"><%= number_to_currency(value, :unit => "£") %></span>
           <span class="highlight"></span>
           <span class="note"></span>
         </div>
       </div>
     </li> -->
 <% end %>
   <% 
#	@brandcount += 1
end %>
   <!-- </ul> -->

<!--</div> -->
</table>
</div>
</div>

<script type="text/javascript">
$('document').ready(function(){

   $('#war_reg').change(function(){
     var syear= $('#war_reg').val(); 
     	
 $.ajax({
  url: '/home/select_orders_of_year?year='+syear,
  success: function(data) {
   $('#result').html(data);}
});
   });

});

</script>
