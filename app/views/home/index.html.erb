<div>
<% if !@o_years.blank? %>
<% if @order_year %><div class="ordernav">
   <select id="war_reg">
                    <% @order_year.each do |w| %>
	          	        <option value="<%= w %>"><%= w %></option>
    	         <% end %>	           
	       </select>
  <% end %>  <% end %> <div class="fetchorders"><a href="/pull_all_orders" onclick="showHidePreloader(true);">Fetch Orders</a></div>
<div id="preloader"><img src="/images/ajax-loader-1.gif" /></div></div>

<div id="orders">	
 <div id="result">
	
  <% if @local_orders.blank? %>  
    <em class="note">We have none of your orders yet, click "Fetch Orders" to download them now. <br />
	<strong>Please be patient</strong>, this first time it could take quite a few minutes to download them all. After this initial download, it will be super dooper quick.</em>
  <% else %>
<% @localcurrency = session[:shopifyshop][:currency] %>
 <table>
  <tr>
    <th>Vendor Name</th>
     <% @months.each do |m| %>
     <th><%= m %> </th>
      <% end %>
		<th>Total</th>
      </tr>
    
   <% @m = [1,2,3,4,5,6,7,8,9,10,11,12]%> 
   <% @v_size = @local_vendors.size %>
   <% @local_vendors.each do |v| %>
   <% @newbrandtotal = 0 %>
  <tr>
  <th> <%= v.vendor %></th>
   
   <% @years = {} %>
   <% @local_orders.each do |l| %>
   
   <% if l.vendor_name == v.vendor %>
   
   <% @m.each do |m| %>
     
     <% if l.month_list == m.to_s %>
       
     <% @years[v.vendor] ||= {}%>
     <% @years[v.vendor][m] ||= [] %>
     <% @years[v.vendor][m] << number_to_currency(l.totcost, :unit => @localcurrency) %>
	 <% @newbrandtotal += (l.totcost).to_d  %>
	 <% @years[v.vendor][13] = @newbrandtotal.to_s
		
		%>
     <% end %>
     <% end %>
     <% end %>
     <% end %>
  
     <% if !@years.blank? %> 
     <% @years.each do |y| %>
        	<% if y[0] == v.vendor %>
  		
     				<% if !y[1][1].blank? %><td><%= change_to_value(y[1][1].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][2].blank? %><td><%=change_to_value(y[1][2].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][3].blank? %><td><%=change_to_value(y[1][3].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][4].blank? %><td><%=change_to_value(y[1][4].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][5].blank? %><td><%=change_to_value(y[1][5].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][6].blank? %><td><%=change_to_value(y[1][6].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][7].blank? %><td><%=change_to_value(y[1][7].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][8].blank? %><td><%=change_to_value(y[1][8].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][9].blank? %><td><%=change_to_value(y[1][9].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][10].blank? %><td><%=change_to_value(y[1][10].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][11].blank? %><td><%=change_to_value(y[1][11].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][12].blank? %><td><%=change_to_value(y[1][12].to_s) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     				<% if !y[1][13].blank? %><td><%=number_to_currency(y[1][13],:unit => @localcurrency) %></td><%else %><td><%= number_to_currency(0,:unit => @localcurrency) %></td><% end %>
     	<% end %>
     	<% end %>
    <% else %>
        	<td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td><td><%= number_to_currency(0,:unit => @localcurrency) %></td>
    <% end %>

</tr> 
     <% end %>
  </table>
  <% end %>
  </div>
</div>
</div>

<script type="text/javascript">
$('document').ready(function(){

   $('#war_reg').change(function(){
     var syear= $('#war_reg').val(); 
     	
 $.ajax({

  url: '/home/select_orders_of_year?year='+syear,
  success: function(data) {
   $('#result').html(data);}
});
   });

});

</script>